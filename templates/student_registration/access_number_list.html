
{% extends 'student_registration/base.html' %}

{% block content %}
<h2>Semester Codes</h2>

<div class="d-flex justify-content-between align-items-center mb-4">
    <form method="get" class="row gx-2 flex-grow-1">
        <div class="col-md-3">
            <select name="academic_year" class="form-control">
                <option value="">All Academic Years</option>
                {% for ay in academic_years %}
                <option value="{{ ay.id }}" {% if ay.id|stringformat:"s" == selected_academic_year %}selected{% endif %}>
                    {{ ay }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <select name="semester" class="form-control">
                <option value="">All Semesters</option>
                {% for s in semesters %}
                <option value="{{ s.id }}" {% if s.id|stringformat:"s" == selected_semester %}selected{% endif %}>
                    {{ s }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <input type="text" name="program" class="form-control" placeholder="Program Code" value="{{ selected_program }}">
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
    </form>

    <!-- Action Buttons -->
    <div class="ms-3">
        <a href="{% url 'pass_book:bulk_generate' %}" class="btn btn-success">Bulk Generate</a>
        <!-- Optional: Link to student list to generate individually -->
        <a href="{% url 'pass_book:list' %}" class="btn btn-outline-primary">Students</a>
    </div>
</div>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    {% endfor %}
{% endif %}

<table class="table table-striped table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>Semester Code</th>
            <th>Student</th>
            <th>Academic Year</th>
            <th>Semester</th>
            <th>Year of Study</th>
            <th>Status</th>
            <th>Generated</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for an in access_numbers %}
        <tr>
            <td><code>{{ an.access_number }}</code></td>
            <td>
                <a href="{% url 'pass_book:detail' an.access_number %}" class="text-decoration-none">
                    {{ an.student.name }}
                </a>
            </td>
            <td>{{ an.academic_year }}</td>
            <td>{{ an.semester }}</td>
            <td>{{ an.year_of_study }}</td>
            <td>
                {% if an.is_active %}
                <span class="badge bg-success">Active</span>
                {% else %}
                <span class="badge bg-secondary">Inactive</span>
                {% endif %}
            </td>
            <td>{{ an.generated_date|date:"Y-m-d H:i" }}</td>
            <td class="d-flex gap-1">
                <a href="{% url 'pass_book:detail' an.access_number %}" class="btn btn-sm btn-info">View</a>
                {% if an.is_active %}
                <a href="{% url 'pass_book:deactivate' an.access_number %}" class="btn btn-sm btn-warning">Deactivate</a>
                {% endif %}
                <!-- Optional: Generate new one (if needed for same student/semester â€” though unique_together should prevent) -->
                <!-- <a href="{% url 'pass_book:generate_single' an.student.id %}" class="btn btn-sm btn-outline-primary">Regenerate</a> -->
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="8" class="text-center py-4">
                <div class="text-muted">No access numbers found.</div>
                <a href="{% url 'pass_book:bulk_generate' %}" class="btn btn-sm btn-outline-success mt-2">Generate Some</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Optional: Pagination (if you add it later) -->
<!--
<div class="d-flex justify-content-center mt-4">
    <nav>
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page=1">First</a></li>
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}

            <li class="page-item active"><span class="page-link">{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a></li>
            {% endif %}
        </ul>
    </nav>
</div>
-->
{% endblock %}


